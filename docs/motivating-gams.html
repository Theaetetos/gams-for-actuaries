<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Motivating GAMs | Generalized Additive Models for Actuaries</title>
  <meta name="description" content="An Introduction to Generalized Additive Models for Health Actuarial Business Problems." />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Motivating GAMs | Generalized Additive Models for Actuaries" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="An Introduction to Generalized Additive Models for Health Actuarial Business Problems." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Motivating GAMs | Generalized Additive Models for Actuaries" />
  
  <meta name="twitter:description" content="An Introduction to Generalized Additive Models for Health Actuarial Business Problems." />
  

<meta name="author" content="Nathan Cornwell" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="utilization-forecasting.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Bookdown Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#our-workspace"><i class="fa fa-check"></i><b>0.1</b> Our Workspace</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#preliminaries"><i class="fa fa-check"></i><b>0.2</b> Preliminaries</a>
<ul>
<li class="chapter" data-level="0.2.1" data-path="index.html"><a href="index.html#branding-code"><i class="fa fa-check"></i><b>0.2.1</b> Branding Code</a></li>
<li class="chapter" data-level="0.2.2" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i><b>0.2.2</b> Packages</a></li>
<li class="chapter" data-level="0.2.3" data-path="index.html"><a href="index.html#some-of-our-datasets"><i class="fa fa-check"></i><b>0.2.3</b> (Some of our) Datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="motivating-gams.html"><a href="motivating-gams.html"><i class="fa fa-check"></i><b>1</b> Motivating GAMs</a>
<ul>
<li class="chapter" data-level="1.1" data-path="motivating-gams.html"><a href="motivating-gams.html#linear-regression"><i class="fa fa-check"></i><b>1.1</b> Linear Regression</a></li>
<li class="chapter" data-level="1.2" data-path="motivating-gams.html"><a href="motivating-gams.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="motivating-gams.html"><a href="motivating-gams.html#model-fitting"><i class="fa fa-check"></i><b>1.3</b> Model Fitting</a></li>
<li class="chapter" data-level="1.4" data-path="motivating-gams.html"><a href="motivating-gams.html#generalized-linear-models"><i class="fa fa-check"></i><b>1.4</b> Generalized Linear Models</a></li>
<li class="chapter" data-level="1.5" data-path="motivating-gams.html"><a href="motivating-gams.html#generalized-additive-models"><i class="fa fa-check"></i><b>1.5</b> Generalized Additive Models</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html"><i class="fa fa-check"></i><b>2</b> Utilization Forecasting</a>
<ul>
<li class="chapter" data-level="2.1" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#data-1"><i class="fa fa-check"></i><b>2.2</b> Data</a></li>
<li class="chapter" data-level="2.3" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#predictors"><i class="fa fa-check"></i><b>2.3</b> Predictors</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#weekday"><i class="fa fa-check"></i><b>2.3.1</b> Weekday</a></li>
<li class="chapter" data-level="2.3.2" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#in-year"><i class="fa fa-check"></i><b>2.3.2</b> In-year</a></li>
<li class="chapter" data-level="2.3.3" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#holidays"><i class="fa fa-check"></i><b>2.3.3</b> Holidays</a></li>
<li class="chapter" data-level="2.3.4" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#covid"><i class="fa fa-check"></i><b>2.3.4</b> COVID</a></li>
<li class="chapter" data-level="2.3.5" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#trend"><i class="fa fa-check"></i><b>2.3.5</b> Trend</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#model-fitting-1"><i class="fa fa-check"></i><b>2.4</b> Model Fitting</a></li>
<li class="chapter" data-level="2.5" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#making-predictions"><i class="fa fa-check"></i><b>2.5</b> Making Predictions</a></li>
<li class="chapter" data-level="2.6" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#alternative-trend-forecast"><i class="fa fa-check"></i><b>2.6</b> Alternative Trend Forecast</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#model-fitting-2"><i class="fa fa-check"></i><b>2.6.1</b> Model Fitting</a></li>
<li class="chapter" data-level="2.6.2" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#making-predictions-1"><i class="fa fa-check"></i><b>2.6.2</b> Making Predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html"><i class="fa fa-check"></i><b>3</b> Hurricane Impact Valuation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#data-2"><i class="fa fa-check"></i><b>3.2</b> Data</a></li>
<li class="chapter" data-level="3.3" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#model-fitting-3"><i class="fa fa-check"></i><b>3.3</b> Model Fitting</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#initial-model"><i class="fa fa-check"></i><b>3.3.1</b> Initial Model</a></li>
<li class="chapter" data-level="3.3.2" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#deriving-the-holiday-list"><i class="fa fa-check"></i><b>3.3.2</b> Deriving the Holiday List</a></li>
<li class="chapter" data-level="3.3.3" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#hurricane-effect-window"><i class="fa fa-check"></i><b>3.3.3</b> Hurricane Effect Window</a></li>
<li class="chapter" data-level="3.3.4" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#penultimate-model"><i class="fa fa-check"></i><b>3.3.4</b> Penultimate Model</a></li>
<li class="chapter" data-level="3.3.5" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#serial-autocorrelation-of-errors"><i class="fa fa-check"></i><b>3.3.5</b> Serial Autocorrelation of Errors</a></li>
<li class="chapter" data-level="3.3.6" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#heteroskedasticity"><i class="fa fa-check"></i><b>3.3.6</b> Heteroskedasticity</a></li>
<li class="chapter" data-level="3.3.7" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#final-model"><i class="fa fa-check"></i><b>3.3.7</b> Final Model</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#using-the-model"><i class="fa fa-check"></i><b>3.4</b> Using the Model</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html"><i class="fa fa-check"></i><b>4</b> Valuation of Care Interventions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#data-3"><i class="fa fa-check"></i><b>4.2</b> Data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#processed-dataset"><i class="fa fa-check"></i><b>4.2.1</b> Processed Dataset</a></li>
<li class="chapter" data-level="4.2.2" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#exposure"><i class="fa fa-check"></i><b>4.2.2</b> Exposure</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#model-fitting-4"><i class="fa fa-check"></i><b>4.3</b> Model Fitting</a></li>
<li class="chapter" data-level="4.4" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#using-the-model-1"><i class="fa fa-check"></i><b>4.4</b> Using the Model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Generalized Additive Models for Actuaries</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="motivating-gams" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Chapter 1</span> Motivating GAMs<a href="motivating-gams.html#motivating-gams" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="linear-regression" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Linear Regression<a href="motivating-gams.html#linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll start with good ol’ linear regression and build up to generalized additive models.
The mathematical form of linear regression is</p>
<p><span class="math display">\[
y \sim \beta_0+\sum_{i=1}^n \beta_i x_i+ \epsilon \\
\epsilon \sim N(0,\sigma^2)
\]</span>
In English, some <em>response variable</em> <span class="math inline">\(y\)</span> is modeled as the sum of an <em>intercept</em> term <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(n\)</span> <em>predictor variables</em> <span class="math inline">\(x_1,...,x_n\)</span> with random <em>error</em> <span class="math inline">\(\epsilon \sim N(0,\sigma^2)\)</span>.</p>
</div>
<div id="data" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Data<a href="motivating-gams.html#data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I will skip straight to a fully-processed dataset based on other tutorials I’ve given with this data.
The main things I’m doing are converting the categorical variables to factors (they are ordered factors in the original data for some reason) and setting the reference level to the one that occurs the most frequently in the data.
As you have learned or will learn on the Predictive Analytics exam, this is general best practice.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="motivating-gams.html#cb5-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(diamonds)</span>
<span id="cb5-2"><a href="motivating-gams.html#cb5-2" aria-hidden="true" tabindex="-1"></a>dat[</span>
<span id="cb5-3"><a href="motivating-gams.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb5-4"><a href="motivating-gams.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  clarity <span class="sc">:</span><span class="er">=</span> <span class="fu">relevel</span>(</span>
<span id="cb5-5"><a href="motivating-gams.html#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(</span>
<span id="cb5-6"><a href="motivating-gams.html#cb5-6" aria-hidden="true" tabindex="-1"></a>      clarity,</span>
<span id="cb5-7"><a href="motivating-gams.html#cb5-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">ordered =</span> F</span>
<span id="cb5-8"><a href="motivating-gams.html#cb5-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-9"><a href="motivating-gams.html#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref =</span> <span class="st">&#39;SI1&#39;</span></span>
<span id="cb5-10"><a href="motivating-gams.html#cb5-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-11"><a href="motivating-gams.html#cb5-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-12"><a href="motivating-gams.html#cb5-12" aria-hidden="true" tabindex="-1"></a>dat[</span>
<span id="cb5-13"><a href="motivating-gams.html#cb5-13" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb5-14"><a href="motivating-gams.html#cb5-14" aria-hidden="true" tabindex="-1"></a>  color <span class="sc">:</span><span class="er">=</span> <span class="fu">relevel</span>(</span>
<span id="cb5-15"><a href="motivating-gams.html#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(</span>
<span id="cb5-16"><a href="motivating-gams.html#cb5-16" aria-hidden="true" tabindex="-1"></a>      color,</span>
<span id="cb5-17"><a href="motivating-gams.html#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">ordered =</span> F</span>
<span id="cb5-18"><a href="motivating-gams.html#cb5-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-19"><a href="motivating-gams.html#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref =</span> <span class="st">&#39;G&#39;</span></span>
<span id="cb5-20"><a href="motivating-gams.html#cb5-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-21"><a href="motivating-gams.html#cb5-21" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-22"><a href="motivating-gams.html#cb5-22" aria-hidden="true" tabindex="-1"></a>dat[</span>
<span id="cb5-23"><a href="motivating-gams.html#cb5-23" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb5-24"><a href="motivating-gams.html#cb5-24" aria-hidden="true" tabindex="-1"></a>  cut <span class="sc">:</span><span class="er">=</span> <span class="fu">relevel</span>(</span>
<span id="cb5-25"><a href="motivating-gams.html#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(</span>
<span id="cb5-26"><a href="motivating-gams.html#cb5-26" aria-hidden="true" tabindex="-1"></a>      cut,</span>
<span id="cb5-27"><a href="motivating-gams.html#cb5-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">ordered =</span> F</span>
<span id="cb5-28"><a href="motivating-gams.html#cb5-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-29"><a href="motivating-gams.html#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref =</span> <span class="st">&#39;Ideal&#39;</span></span>
<span id="cb5-30"><a href="motivating-gams.html#cb5-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-31"><a href="motivating-gams.html#cb5-31" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div id="model-fitting" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Model Fitting<a href="motivating-gams.html#model-fitting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can fit a linear regression to our diamonds dataset as follows.
I leave out the <code>depth</code> and <code>table</code> variables because, although I’ve tried quite a bit, I don’t understand them and don’t trust their contributions to the model.
You’ll just have to trust me on this for now, but I’d love to have someone explain how to incorporate them into a model in a rigorous way.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="motivating-gams.html#cb6-1" aria-hidden="true" tabindex="-1"></a>m_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> carat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity, <span class="at">data =</span> dat)</span></code></pre></div>
<p>The first thing to do with a model is to examine the estimated coefficients.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="motivating-gams.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_lm)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = price ~ carat + cut + color + clarity, data = dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -16813.5   -680.4   -197.6    466.4  10394.9 
## 
## Coefficients:
##              Estimate Std. Error  t value Pr(&gt;|t|)    
## (Intercept)  -3297.06      18.84 -175.049   &lt;2e-16 ***
## carat         8886.13      12.03  738.437   &lt;2e-16 ***
## cutFair       -998.25      30.66  -32.563   &lt;2e-16 ***
## cutGood       -342.49      18.52  -18.489   &lt;2e-16 ***
## cutVery Good  -149.54      13.27  -11.273   &lt;2e-16 ***
## cutPremium    -128.86      12.89   -9.994   &lt;2e-16 ***
## colorD         506.20      18.12   27.933   &lt;2e-16 ***
## colorE         294.52      16.20   18.183   &lt;2e-16 ***
## colorF         202.89      16.15   12.561   &lt;2e-16 ***
## colorH        -472.50      16.86  -28.029   &lt;2e-16 ***
## colorI        -934.10      19.36  -48.239   &lt;2e-16 ***
## colorJ       -1819.02      24.84  -73.227   &lt;2e-16 ***
## clarityI1    -3573.69      44.60  -80.132   &lt;2e-16 ***
## claritySI2    -947.74      16.00  -59.224   &lt;2e-16 ***
## clarityVS2     644.14      14.64   44.006   &lt;2e-16 ***
## clarityVS1     961.19      16.53   58.137   &lt;2e-16 ***
## clarityVVS2   1393.51      19.55   71.262   &lt;2e-16 ***
## clarityVVS1   1498.34      22.25   67.341   &lt;2e-16 ***
## clarityIF     1845.96      29.86   61.827   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1157 on 53921 degrees of freedom
## Multiple R-squared:  0.9159, Adjusted R-squared:  0.9159 
## F-statistic: 3.264e+04 on 18 and 53921 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>This readout gives us a ton of information.</p>
<p>The first thing I like to look at is the <em>p-values</em> for all of the terms we included in our model.
This can be found in the column labeled <code>Pr(&gt;|t|)</code>.
These are the probabilities that we would observe an effect of the size estimated by the model due to chance.
We want this probability to be below some <em>critical value</em> <span class="math inline">\(\alpha\)</span>, which is usually set to .05.
If the probability is above <span class="math inline">\(\alpha\)</span>, then we don’t have enough evidence to include that term in our model.
We call estimated coefficients with a p-value less than <span class="math inline">\(\alpha\)</span> <em>statistically significant</em>.</p>
<p>The second thing I look at is the <em>adjusted R-squared</em>, or <span class="math inline">\(R^2_{adj}\)</span>.
<span class="math inline">\(R^2\)</span> is usually interpreted as the proportion of variance in the response variable that is explained by the model.
Higher values are always better, but there is no overarching threshold that you should shoot for.
Some fields of study, such as biology, psychology, and unfortunately for us, short-term actuarial science, are simply subject to very high variance, so <span class="math inline">\(R^2\)</span> as low as .1 can be acceptable even for peer-reviewed studies.
<span class="math inline">\(R^2_{adj}\)</span> adds a penalty for each term in the model, since <span class="math inline">\(R^2\)</span> always improves by at least a little whenever a term is added.</p>
<p>Even though we’ve learned a lot from this readout, and all of it sounds good, we are by no means done.
The next thing I like to do is plot actuals vs. predicted to see if the relationships between variables estimated by the model are tracking those in the data.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="motivating-gams.html#cb9-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat, <span class="at">predicted =</span> <span class="fu">predict</span>(m_lm))</span>
<span id="cb9-2"><a href="motivating-gams.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="motivating-gams.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(preds) <span class="sc">+</span></span>
<span id="cb9-4"><a href="motivating-gams.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(price, predicted)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="motivating-gams.html#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb9-6"><a href="motivating-gams.html#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb9-7"><a href="motivating-gams.html#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb9-8"><a href="motivating-gams.html#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> colors<span class="sc">$</span>Visualization<span class="sc">$</span>Strawberry</span>
<span id="cb9-9"><a href="motivating-gams.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-10"><a href="motivating-gams.html#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb9-11"><a href="motivating-gams.html#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb9-12"><a href="motivating-gams.html#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Actual&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Predicted&#39;</span>) <span class="sc">+</span></span>
<span id="cb9-13"><a href="motivating-gams.html#cb9-13" aria-hidden="true" tabindex="-1"></a>  mytheme</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>This plot shows us that our model may not be so great after all.
The red line shows us what a perfect model with zero residual variance would look like.
It’s clear that our model is significantly over-predicting the prices of very cheap and very expensive diamonds.
Our coefficients may have passed the test for statistical significance, but it looks there’s more going on in the data than we were able to capture.</p>
<p>There is a lot more validation work to be done, but I am going to put that off until we get to GAMs because that is the model form we’re most interested in.</p>
</div>
<div id="generalized-linear-models" class="section level2 hasAnchor" number="1.4">
<h2><span class="header-section-number">1.4</span> Generalized Linear Models<a href="motivating-gams.html#generalized-linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generalized linear models (GLMs) were introduced in 1972 as a formal specification of a family of models that includes linear regression as well as many others. Compared to linear regression, GLMs have relaxed constraints on the assumed error distribution and add a <em>link function</em> to the model form. Mathematically, a GLM is:</p>
<ol style="list-style-type: decimal">
<li>A random variable <span class="math inline">\(Y\)</span> that is conditionally distributed according to a member of the <em>linear exponential family</em> of distributions;<br />
</li>
<li>A linear predictor <span class="math inline">\(\eta = \sum_{i=0}^n{\beta_iX_i}\)</span>; and<br />
</li>
<li>A link function <span class="math inline">\(g\)</span> such that <span class="math inline">\(E(Y|X) = g^{-1}(\eta)\)</span>.</li>
</ol>
<p>We don’t need to bother with the mathematics of the linear exponential family. It’s enough for us to note that it contains a distribution for basically any modeling problem:</p>
<ul>
<li>Bernoulli - The probability that an event will occur; e.g. a patient will develop sepsis<br />
</li>
<li>Binomial/Negative Binomial - The expected number of occurrences out of <span class="math inline">\(N\)</span> trials; e.g. the count of distinct medications a member will take in a year<br />
</li>
<li>Poisson - The expected number of occurrences in a given amount of time/space; e.g. the number of patients visiting a doctor’s office in a day<br />
</li>
<li>Normal - A numeric value on the real line</li>
</ul>
<p>You can see a full list <a href="https://en.wikipedia.org/wiki/Generalized_linear_model">here</a>.</p>
<p>Note that the last error assumption, when paired with the identity link function, is simply linear regression. You may also know the Bernoulli case as <em>logistic regression</em>, named for its canonical link function, the logistic function <span class="math inline">\(\frac{L}{1+e^{-k(x-x_0)}}\)</span>.</p>
<p>We will first take advantage of the GLM’s ability to add a link function.
It’s basically always a good idea to use a log link when working with price data, if only because the range of possible predicted values is restricted to the positive reals - we almost never want to predict a negative price.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="motivating-gams.html#cb10-1" aria-hidden="true" tabindex="-1"></a>m_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb10-2"><a href="motivating-gams.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  price <span class="sc">~</span> carat <span class="sc">+</span> cut <span class="sc">+</span> color <span class="sc">+</span> clarity,</span>
<span id="cb10-3"><a href="motivating-gams.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">&#39;log&#39;</span>),</span>
<span id="cb10-4"><a href="motivating-gams.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat</span>
<span id="cb10-5"><a href="motivating-gams.html#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-6"><a href="motivating-gams.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_glm)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = price ~ carat + cut + color + clarity, family = gaussian(link = &quot;log&quot;), 
##     data = dat)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -75260   -1291    -695     695   12438  
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   7.036821   0.005621 1251.79   &lt;2e-16 ***
## carat         1.397089   0.002699  517.66   &lt;2e-16 ***
## cutFair      -0.237914   0.008208  -28.98   &lt;2e-16 ***
## cutGood      -0.079164   0.004953  -15.98   &lt;2e-16 ***
## cutVery Good -0.003201   0.003478   -0.92    0.357    
## cutPremium   -0.041107   0.003208  -12.81   &lt;2e-16 ***
## colorD        0.112976   0.005301   21.31   &lt;2e-16 ***
## colorE        0.063442   0.004702   13.49   &lt;2e-16 ***
## colorF        0.080921   0.004219   19.18   &lt;2e-16 ***
## colorH       -0.152879   0.004081  -37.46   &lt;2e-16 ***
## colorI       -0.305330   0.004384  -69.65   &lt;2e-16 ***
## colorJ       -0.582432   0.005708 -102.05   &lt;2e-16 ***
## clarityI1    -2.340860   0.020895 -112.03   &lt;2e-16 ***
## claritySI2   -0.294332   0.003840  -76.65   &lt;2e-16 ***
## clarityVS2    0.133571   0.003718   35.93   &lt;2e-16 ***
## clarityVS1    0.234327   0.004249   55.15   &lt;2e-16 ***
## clarityVVS2   0.319816   0.005520   57.94   &lt;2e-16 ***
## clarityVVS1   0.285559   0.007516   37.99   &lt;2e-16 ***
## clarityIF     0.400077   0.009034   44.28   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 2513220)
## 
##     Null deviance: 8.5847e+11  on 53939  degrees of freedom
## Residual deviance: 1.3551e+11  on 53921  degrees of freedom
## AIC: 948013
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="motivating-gams.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># type argument must be specified for GLMs</span></span>
<span id="cb12-2"><a href="motivating-gams.html#cb12-2" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat, <span class="at">predicted =</span> <span class="fu">predict</span>(m_glm, <span class="at">type =</span> <span class="st">&#39;response&#39;</span>))</span>
<span id="cb12-3"><a href="motivating-gams.html#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="motivating-gams.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(preds) <span class="sc">+</span></span>
<span id="cb12-5"><a href="motivating-gams.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(price, predicted)) <span class="sc">+</span></span>
<span id="cb12-6"><a href="motivating-gams.html#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb12-7"><a href="motivating-gams.html#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb12-8"><a href="motivating-gams.html#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb12-9"><a href="motivating-gams.html#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> colors<span class="sc">$</span>Visualization<span class="sc">$</span>Strawberry</span>
<span id="cb12-10"><a href="motivating-gams.html#cb12-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-11"><a href="motivating-gams.html#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb12-12"><a href="motivating-gams.html#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb12-13"><a href="motivating-gams.html#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Actual&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Predicted&#39;</span>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="motivating-gams.html#cb12-14" aria-hidden="true" tabindex="-1"></a>  mytheme</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The bulk of our predictions are now centered around the red line, but the problem of predictions being too high for more expensive diamonds is worse.
In addition, there is a region of data points below the main region.
This suggests that the model is missing some relationship in the data.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="motivating-gams.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(preds) <span class="sc">+</span></span>
<span id="cb13-2"><a href="motivating-gams.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb13-3"><a href="motivating-gams.html#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb13-4"><a href="motivating-gams.html#cb13-4" aria-hidden="true" tabindex="-1"></a>      price,</span>
<span id="cb13-5"><a href="motivating-gams.html#cb13-5" aria-hidden="true" tabindex="-1"></a>      predicted,</span>
<span id="cb13-6"><a href="motivating-gams.html#cb13-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># I do this just to make the legend a little more readable</span></span>
<span id="cb13-7"><a href="motivating-gams.html#cb13-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="fu">factor</span>(</span>
<span id="cb13-8"><a href="motivating-gams.html#cb13-8" aria-hidden="true" tabindex="-1"></a>        clarity,</span>
<span id="cb13-9"><a href="motivating-gams.html#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> <span class="fu">rev</span>(</span>
<span id="cb13-10"><a href="motivating-gams.html#cb13-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">&#39;I1&#39;</span>, <span class="st">&#39;SI2&#39;</span>, <span class="st">&#39;SI1&#39;</span>, <span class="st">&#39;VS2&#39;</span>, <span class="st">&#39;VS1&#39;</span>, <span class="st">&#39;VVS2&#39;</span>, <span class="st">&#39;VVS1&#39;</span>, <span class="st">&#39;IF&#39;</span>)</span>
<span id="cb13-11"><a href="motivating-gams.html#cb13-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-12"><a href="motivating-gams.html#cb13-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-13"><a href="motivating-gams.html#cb13-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-14"><a href="motivating-gams.html#cb13-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-15"><a href="motivating-gams.html#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_discrete_optum</span>(<span class="st">&#39;color&#39;</span>) <span class="sc">+</span></span>
<span id="cb13-16"><a href="motivating-gams.html#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb13-17"><a href="motivating-gams.html#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb13-18"><a href="motivating-gams.html#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Actual&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Predicted&#39;</span>, <span class="at">color =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb13-19"><a href="motivating-gams.html#cb13-19" aria-hidden="true" tabindex="-1"></a>  mytheme</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>This residual plot makes the cause of the grouping issue very clear: the price slope for diamonds of clarity IF looks to be quite different from the slopes of the rest of the clarity ratings.
Based on the groupings visible in the above plot, we need to allow the price slope to vary by clarity.
The other main issue is not as clear, but I will skip straight to it to save us time: the price-carat relationship also needs to be able to change slope.
We can implement these changes with the below code.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="motivating-gams.html#cb14-1" aria-hidden="true" tabindex="-1"></a>m_glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb14-2"><a href="motivating-gams.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  price <span class="sc">~</span> <span class="fu">poly</span>(carat, <span class="dv">3</span>)<span class="sc">*</span>clarity <span class="sc">+</span> cut <span class="sc">+</span> color,</span>
<span id="cb14-3"><a href="motivating-gams.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb14-4"><a href="motivating-gams.html#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">&#39;log&#39;</span>)</span>
<span id="cb14-5"><a href="motivating-gams.html#cb14-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="motivating-gams.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_glm2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = price ~ poly(carat, 3) * clarity + cut + color, 
##     family = gaussian(link = &quot;log&quot;), data = dat)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -10624.8    -200.5     -26.5     180.3    7096.0  
## 
## Coefficients:
##                               Estimate Std. Error  t value Pr(&gt;|t|)    
## (Intercept)                   7.768288   0.004583 1695.100  &lt; 2e-16 ***
## poly(carat, 3)1             231.821770   0.913825  253.683  &lt; 2e-16 ***
## poly(carat, 3)2             -54.434208   0.430228 -126.524  &lt; 2e-16 ***
## poly(carat, 3)3              17.669019   0.659020   26.811  &lt; 2e-16 ***
## clarityI1                    -0.264844   0.020736  -12.772  &lt; 2e-16 ***
## claritySI2                   -0.068189   0.007285   -9.361  &lt; 2e-16 ***
## clarityVS2                    0.134356   0.005638   23.829  &lt; 2e-16 ***
## clarityVS1                    0.187955   0.006317   29.753  &lt; 2e-16 ***
## clarityVVS2                   0.291332   0.006866   42.433  &lt; 2e-16 ***
## clarityVVS1                   0.369897   0.007156   51.693  &lt; 2e-16 ***
## clarityIF                     0.469748   0.008872   52.946  &lt; 2e-16 ***
## cutFair                      -0.166446   0.003241  -51.359  &lt; 2e-16 ***
## cutGood                      -0.077725   0.002042  -38.054  &lt; 2e-16 ***
## cutVery Good                 -0.034547   0.001440  -23.995  &lt; 2e-16 ***
## cutPremium                   -0.049561   0.001314  -37.726  &lt; 2e-16 ***
## colorD                        0.174176   0.002176   80.044  &lt; 2e-16 ***
## colorE                        0.128012   0.001929   66.357  &lt; 2e-16 ***
## colorF                        0.090840   0.001746   52.032  &lt; 2e-16 ***
## colorH                       -0.109804   0.001701  -64.550  &lt; 2e-16 ***
## colorI                       -0.200778   0.001837 -109.303  &lt; 2e-16 ***
## colorJ                       -0.348985   0.002333 -149.583  &lt; 2e-16 ***
## poly(carat, 3)1:clarityI1   -68.202418   3.282812  -20.776  &lt; 2e-16 ***
## poly(carat, 3)2:clarityI1    22.986484   1.265368   18.166  &lt; 2e-16 ***
## poly(carat, 3)3:clarityI1   -11.706733   0.725728  -16.131  &lt; 2e-16 ***
## poly(carat, 3)1:claritySI2  -25.448899   1.437627  -17.702  &lt; 2e-16 ***
## poly(carat, 3)2:claritySI2   12.372250   0.705059   17.548  &lt; 2e-16 ***
## poly(carat, 3)3:claritySI2  -14.280810   0.782883  -18.241  &lt; 2e-16 ***
## poly(carat, 3)1:clarityVS2    1.870011   1.125183    1.662 0.096526 .  
## poly(carat, 3)2:clarityVS2   -7.297582   0.575906  -12.671  &lt; 2e-16 ***
## poly(carat, 3)3:clarityVS2   -1.254099   0.737984   -1.699 0.089257 .  
## poly(carat, 3)1:clarityVS1    8.735755   1.319027    6.623 3.56e-11 ***
## poly(carat, 3)2:clarityVS1  -10.865925   0.647157  -16.790  &lt; 2e-16 ***
## poly(carat, 3)3:clarityVS1    9.321429   1.069932    8.712  &lt; 2e-16 ***
## poly(carat, 3)1:clarityVVS2  27.565527   1.790833   15.393  &lt; 2e-16 ***
## poly(carat, 3)2:clarityVVS2  -4.731728   1.433310   -3.301 0.000963 ***
## poly(carat, 3)3:clarityVVS2  54.218689   2.263802   23.950  &lt; 2e-16 ***
## poly(carat, 3)1:clarityVVS1  15.893363   1.679070    9.466  &lt; 2e-16 ***
## poly(carat, 3)2:clarityVVS1 -16.881147   1.315091  -12.836  &lt; 2e-16 ***
## poly(carat, 3)3:clarityVVS1  39.985118   2.186750   18.285  &lt; 2e-16 ***
## poly(carat, 3)1:clarityIF    17.951187   1.938529    9.260  &lt; 2e-16 ***
## poly(carat, 3)2:clarityIF   -13.961946   1.311702  -10.644  &lt; 2e-16 ***
## poly(carat, 3)3:clarityIF    67.110841   2.414828   27.791  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 458620.2)
## 
##     Null deviance: 8.5847e+11  on 53939  degrees of freedom
## Residual deviance: 2.4719e+10  on 53898  degrees of freedom
## AIC: 856280
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="motivating-gams.html#cb16-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat, <span class="at">predicted =</span> <span class="fu">predict</span>(m_glm2, <span class="at">type =</span> <span class="st">&#39;response&#39;</span>))</span>
<span id="cb16-2"><a href="motivating-gams.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="motivating-gams.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(preds) <span class="sc">+</span></span>
<span id="cb16-4"><a href="motivating-gams.html#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(price, predicted)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="motivating-gams.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb16-6"><a href="motivating-gams.html#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb16-7"><a href="motivating-gams.html#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb16-8"><a href="motivating-gams.html#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> colors<span class="sc">$</span>Visualization<span class="sc">$</span>Strawberry</span>
<span id="cb16-9"><a href="motivating-gams.html#cb16-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-10"><a href="motivating-gams.html#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb16-11"><a href="motivating-gams.html#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb16-12"><a href="motivating-gams.html#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Actual&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Predicted&#39;</span>) <span class="sc">+</span></span>
<span id="cb16-13"><a href="motivating-gams.html#cb16-13" aria-hidden="true" tabindex="-1"></a>  mytheme</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>This now looks good enough to get on with.
We can visualize our fancy new price slopes in the following chart.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="motivating-gams.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CJ stands for &#39;Cross Join&#39;, and creates a data.table that is the cartesian product of all of the input vectors</span></span>
<span id="cb17-2"><a href="motivating-gams.html#cb17-2" aria-hidden="true" tabindex="-1"></a>pdat <span class="ot">&lt;-</span> <span class="fu">CJ</span>(</span>
<span id="cb17-3"><a href="motivating-gams.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we need to apply the link function to any numeric variables</span></span>
<span id="cb17-4"><a href="motivating-gams.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">carat =</span> <span class="fu">log</span>(<span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">01</span>, <span class="at">to =</span> <span class="fl">5.01</span>, <span class="at">by =</span> .<span class="dv">01</span>)),</span>
<span id="cb17-5"><a href="motivating-gams.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">clarity =</span> <span class="fu">factor</span>(</span>
<span id="cb17-6"><a href="motivating-gams.html#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">levels</span>(dat<span class="sc">$</span>clarity),</span>
<span id="cb17-7"><a href="motivating-gams.html#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;IF&#39;</span>, <span class="st">&#39;VVS1&#39;</span>, <span class="st">&#39;VVS2&#39;</span>, <span class="st">&#39;VS1&#39;</span>, <span class="st">&#39;VS2&#39;</span>, <span class="st">&#39;SI1&#39;</span>, <span class="st">&#39;SI2&#39;</span>, <span class="st">&#39;I1&#39;</span>)</span>
<span id="cb17-8"><a href="motivating-gams.html#cb17-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-9"><a href="motivating-gams.html#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">cut =</span> <span class="fu">factor</span>(<span class="st">&#39;Ideal&#39;</span>, <span class="at">levels =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>cut)),</span>
<span id="cb17-10"><a href="motivating-gams.html#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">factor</span>(<span class="st">&#39;G&#39;</span>, <span class="at">levels =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>color))</span>
<span id="cb17-11"><a href="motivating-gams.html#cb17-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-12"><a href="motivating-gams.html#cb17-12" aria-hidden="true" tabindex="-1"></a>pdat[</span>
<span id="cb17-13"><a href="motivating-gams.html#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># setting type = &#39;response&#39; applies the inverse link function to the linear predictor for us</span></span>
<span id="cb17-14"><a href="motivating-gams.html#cb17-14" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb17-15"><a href="motivating-gams.html#cb17-15" aria-hidden="true" tabindex="-1"></a>  pred <span class="sc">:</span><span class="er">=</span> <span class="fu">predict</span>(m_glm2, <span class="at">newdata =</span> pdat, <span class="at">type =</span> <span class="st">&#39;response&#39;</span>)</span>
<span id="cb17-16"><a href="motivating-gams.html#cb17-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-17"><a href="motivating-gams.html#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="motivating-gams.html#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pdat, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">exp</span>(carat), <span class="at">group =</span> clarity, <span class="at">color =</span> clarity)) <span class="sc">+</span></span>
<span id="cb17-19"><a href="motivating-gams.html#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb17-20"><a href="motivating-gams.html#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_discrete_optum</span>(<span class="at">aesthetics =</span> <span class="st">&#39;color&#39;</span>) <span class="sc">+</span></span>
<span id="cb17-21"><a href="motivating-gams.html#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb17-22"><a href="motivating-gams.html#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-23"><a href="motivating-gams.html#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&#39;Visualization of Price Slopes&#39;</span>,</span>
<span id="cb17-24"><a href="motivating-gams.html#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&#39;Carat&#39;</span>,</span>
<span id="cb17-25"><a href="motivating-gams.html#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&#39;Price&#39;</span>,</span>
<span id="cb17-26"><a href="motivating-gams.html#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&#39;Clarity&#39;</span></span>
<span id="cb17-27"><a href="motivating-gams.html#cb17-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-28"><a href="motivating-gams.html#cb17-28" aria-hidden="true" tabindex="-1"></a>  mytheme</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="generalized-additive-models" class="section level2 hasAnchor" number="1.5">
<h2><span class="header-section-number">1.5</span> Generalized Additive Models<a href="motivating-gams.html#generalized-additive-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generalized Additive Models (GAMs) were introduced in the 90s by Simon Wood as an extension of GLMs that incorporate a form of <em>functional regression</em>.
They have all of the same characteristics of GLMs in addition to the ability to model functional, not just linear, relationships between predictor variables and the response, as well as an expanded field of error distributions, most notably for actuarial work the Tweedie and Negative Binomial.
Functional relationships are modeled by GAMs using various types of <em>splines</em>, which are piecewise functions that are used to interpolate a continuously-differentiable curve between a collection of points.<br />
The linear predictor for a GAM, therefore, looks like this:</p>
<p><span class="math display">\[\eta = \sum_{i=0}^n\sum_{j=0}^m\beta_{ij}f_j(X_i)\]</span></p>
<p>With the added dimension <span class="math inline">\(j\)</span> denoting the <em>basis dimension</em>, or each “piece” of the piecewise spline <span class="math inline">\(f_j(X_i)\)</span>.<br />
This sounds a lot scarier than it is; it should become clear how splines work in GAMs once we fit one to our diamonds dataset.</p>
<p>GAMs are fit a lot like GLMs.
The function to use is called <code>gam()</code>, and it takes the same arguments <code>formula</code>, <code>data</code>, and <code>family</code> as <code>glm()</code>.
You specify a functional term by wrapping it in <code>s()</code> or one of the other <a href="https://stat.ethz.ch/R-manual/R-devel/library/mgcv/html/smooth.terms.html">smooth constructors</a> offered in the <code>mgcv</code> package.
Here, I am using the <code>ti()</code> (short for <u>t</u>ensor <u>i</u>nteraction) constructor because this is the recommended way to create interaction terms in the context of GAMs.
I also parallelize model fitting, because otherwise fitting takes hours on my 32G work laptop (!).
The <code>bam()</code> function is just short for <u>b</u>ig <u>g</u>am and includes a new argument, <code>cluster</code>, which is a parallel computing cluster created using the <code>parallel</code> package.
It is recommended to fit GAMs in parallel if the number of rows in your training dataset is five figures or more.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="motivating-gams.html#cb18-1" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> <span class="fu">makePSOCKcluster</span>(<span class="fu">detectCores</span>())</span>
<span id="cb18-2"><a href="motivating-gams.html#cb18-2" aria-hidden="true" tabindex="-1"></a>m_gam <span class="ot">&lt;-</span> <span class="fu">bam</span>(</span>
<span id="cb18-3"><a href="motivating-gams.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  price <span class="sc">~</span> <span class="fu">ti</span>(carat) <span class="sc">+</span> clarity <span class="sc">+</span> <span class="fu">ti</span>(carat, <span class="at">by =</span> clarity) <span class="sc">+</span> cut <span class="sc">+</span> color,</span>
<span id="cb18-4"><a href="motivating-gams.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat,</span>
<span id="cb18-5"><a href="motivating-gams.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">&#39;log&#39;</span>),</span>
<span id="cb18-6"><a href="motivating-gams.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> cluster</span>
<span id="cb18-7"><a href="motivating-gams.html#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="motivating-gams.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># you must always stop the cluster you create</span></span>
<span id="cb18-9"><a href="motivating-gams.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cluster)</span>
<span id="cb18-10"><a href="motivating-gams.html#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_gam)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: log 
## 
## Formula:
## price ~ ti(carat) + clarity + ti(carat, by = clarity) + cut + 
##     color
## 
## Parametric coefficients:
##               Estimate Std. Error  t value Pr(&gt;|t|)    
## (Intercept)   7.709623   0.005248 1468.977   &lt;2e-16 ***
## clarityI1    -0.469449   0.051876   -9.049   &lt;2e-16 ***
## claritySI2   -0.148794   0.010080  -14.762   &lt;2e-16 ***
## clarityVS2    0.147028   0.006516   22.563   &lt;2e-16 ***
## clarityVS1    0.213806   0.007026   30.430   &lt;2e-16 ***
## clarityVVS2   0.341344   0.007509   45.460   &lt;2e-16 ***
## clarityVVS1   0.417397   0.007547   55.308   &lt;2e-16 ***
## clarityIF     0.514192   0.009151   56.189   &lt;2e-16 ***
## cutFair      -0.169132   0.003161  -53.510   &lt;2e-16 ***
## cutGood      -0.080538   0.001996  -40.359   &lt;2e-16 ***
## cutVery Good -0.036635   0.001407  -26.043   &lt;2e-16 ***
## cutPremium   -0.049751   0.001282  -38.805   &lt;2e-16 ***
## colorD        0.176630   0.002124   83.155   &lt;2e-16 ***
## colorE        0.130101   0.001883   69.087   &lt;2e-16 ***
## colorF        0.091305   0.001704   53.578   &lt;2e-16 ***
## colorH       -0.111324   0.001661  -67.014   &lt;2e-16 ***
## colorI       -0.204098   0.001800 -113.366   &lt;2e-16 ***
## colorJ       -0.349960   0.002283 -153.310   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                          edf Ref.df       F  p-value    
## ti(carat)             3.9969  4.000 6450.26  &lt; 2e-16 ***
## ti(carat):claritySI1  3.9573  3.999   61.37  &lt; 2e-16 ***
## ti(carat):clarityI1   3.7512  3.944  117.79  &lt; 2e-16 ***
## ti(carat):claritySI2  3.9663  3.999  172.61  &lt; 2e-16 ***
## ti(carat):clarityVS2  0.9998  1.001   11.51 0.000692 ***
## ti(carat):clarityVS1  3.9317  3.997   21.21  &lt; 2e-16 ***
## ti(carat):clarityVVS2 3.8454  3.977   99.29  &lt; 2e-16 ***
## ti(carat):clarityVVS1 3.8206  3.971   82.44  &lt; 2e-16 ***
## ti(carat):clarityIF   2.9045  2.991  209.77  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Rank: 53/54
## R-sq.(adj) =  0.973   Deviance explained = 97.3%
## fREML = 4.2696e+05  Scale est. = 4.3652e+05  n = 53940</code></pre>
<p>Let’s compare these price slopes to those from our original GLM fit.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="motivating-gams.html#cb20-1" aria-hidden="true" tabindex="-1"></a>pdat[</span>
<span id="cb20-2"><a href="motivating-gams.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb20-3"><a href="motivating-gams.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb20-4"><a href="motivating-gams.html#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">gam =</span> <span class="fu">predict</span>(m_gam, <span class="at">newdata =</span> pdat, <span class="at">type =</span> <span class="st">&#39;response&#39;</span>),</span>
<span id="cb20-5"><a href="motivating-gams.html#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">glm =</span> pred</span>
<span id="cb20-6"><a href="motivating-gams.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-7"><a href="motivating-gams.html#cb20-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-8"><a href="motivating-gams.html#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="motivating-gams.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pdat, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">exp</span>(carat), <span class="at">group =</span> clarity, <span class="at">color =</span> clarity)) <span class="sc">+</span></span>
<span id="cb20-10"><a href="motivating-gams.html#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> glm), <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="motivating-gams.html#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> gam)) <span class="sc">+</span></span>
<span id="cb20-12"><a href="motivating-gams.html#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_discrete_optum</span>(<span class="at">aesthetics =</span> <span class="st">&#39;color&#39;</span>) <span class="sc">+</span></span>
<span id="cb20-13"><a href="motivating-gams.html#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> dollar) <span class="sc">+</span></span>
<span id="cb20-14"><a href="motivating-gams.html#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-15"><a href="motivating-gams.html#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&#39;Visualization of Price Slopes&#39;</span>,</span>
<span id="cb20-16"><a href="motivating-gams.html#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&#39;Carat&#39;</span>,</span>
<span id="cb20-17"><a href="motivating-gams.html#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&#39;Price&#39;</span>,</span>
<span id="cb20-18"><a href="motivating-gams.html#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&#39;Clarity&#39;</span></span>
<span id="cb20-19"><a href="motivating-gams.html#cb20-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-20"><a href="motivating-gams.html#cb20-20" aria-hidden="true" tabindex="-1"></a>  mytheme</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Here, we can see that the polynomial relationship between carat and price we modeled with a GLM is picked up automatically by the GAM.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="utilization-forecasting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
