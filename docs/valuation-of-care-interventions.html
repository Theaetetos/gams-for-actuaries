<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Valuation of Care Interventions | Generalized Additive Models for Actuaries</title>
  <meta name="description" content="An Introduction to Generalized Additive Models for Health Actuarial Business Problems." />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Valuation of Care Interventions | Generalized Additive Models for Actuaries" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="An Introduction to Generalized Additive Models for Health Actuarial Business Problems." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Valuation of Care Interventions | Generalized Additive Models for Actuaries" />
  
  <meta name="twitter:description" content="An Introduction to Generalized Additive Models for Health Actuarial Business Problems." />
  

<meta name="author" content="Nathan Cornwell" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hurricane-impact-valuation.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Bookdown Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#our-workspace"><i class="fa fa-check"></i><b>0.1</b> Our Workspace</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#preliminaries"><i class="fa fa-check"></i><b>0.2</b> Preliminaries</a>
<ul>
<li class="chapter" data-level="0.2.1" data-path="index.html"><a href="index.html#branding-code"><i class="fa fa-check"></i><b>0.2.1</b> Branding Code</a></li>
<li class="chapter" data-level="0.2.2" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i><b>0.2.2</b> Packages</a></li>
<li class="chapter" data-level="0.2.3" data-path="index.html"><a href="index.html#some-of-our-datasets"><i class="fa fa-check"></i><b>0.2.3</b> (Some of our) Datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="motivating-gams.html"><a href="motivating-gams.html"><i class="fa fa-check"></i><b>1</b> Motivating GAMs</a>
<ul>
<li class="chapter" data-level="1.1" data-path="motivating-gams.html"><a href="motivating-gams.html#linear-regression"><i class="fa fa-check"></i><b>1.1</b> Linear Regression</a></li>
<li class="chapter" data-level="1.2" data-path="motivating-gams.html"><a href="motivating-gams.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="motivating-gams.html"><a href="motivating-gams.html#model-fitting"><i class="fa fa-check"></i><b>1.3</b> Model Fitting</a></li>
<li class="chapter" data-level="1.4" data-path="motivating-gams.html"><a href="motivating-gams.html#generalized-linear-models"><i class="fa fa-check"></i><b>1.4</b> Generalized Linear Models</a></li>
<li class="chapter" data-level="1.5" data-path="motivating-gams.html"><a href="motivating-gams.html#generalized-additive-models"><i class="fa fa-check"></i><b>1.5</b> Generalized Additive Models</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html"><i class="fa fa-check"></i><b>2</b> Utilization Forecasting</a>
<ul>
<li class="chapter" data-level="2.1" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#data-1"><i class="fa fa-check"></i><b>2.2</b> Data</a></li>
<li class="chapter" data-level="2.3" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#predictors"><i class="fa fa-check"></i><b>2.3</b> Predictors</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#weekday"><i class="fa fa-check"></i><b>2.3.1</b> Weekday</a></li>
<li class="chapter" data-level="2.3.2" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#in-year"><i class="fa fa-check"></i><b>2.3.2</b> In-year</a></li>
<li class="chapter" data-level="2.3.3" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#holidays"><i class="fa fa-check"></i><b>2.3.3</b> Holidays</a></li>
<li class="chapter" data-level="2.3.4" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#covid"><i class="fa fa-check"></i><b>2.3.4</b> COVID</a></li>
<li class="chapter" data-level="2.3.5" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#trend"><i class="fa fa-check"></i><b>2.3.5</b> Trend</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#model-fitting-1"><i class="fa fa-check"></i><b>2.4</b> Model Fitting</a></li>
<li class="chapter" data-level="2.5" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#making-predictions"><i class="fa fa-check"></i><b>2.5</b> Making Predictions</a></li>
<li class="chapter" data-level="2.6" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#alternative-trend-forecast"><i class="fa fa-check"></i><b>2.6</b> Alternative Trend Forecast</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#model-fitting-2"><i class="fa fa-check"></i><b>2.6.1</b> Model Fitting</a></li>
<li class="chapter" data-level="2.6.2" data-path="utilization-forecasting.html"><a href="utilization-forecasting.html#making-predictions-1"><i class="fa fa-check"></i><b>2.6.2</b> Making Predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html"><i class="fa fa-check"></i><b>3</b> Hurricane Impact Valuation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#data-2"><i class="fa fa-check"></i><b>3.2</b> Data</a></li>
<li class="chapter" data-level="3.3" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#model-fitting-3"><i class="fa fa-check"></i><b>3.3</b> Model Fitting</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#initial-model"><i class="fa fa-check"></i><b>3.3.1</b> Initial Model</a></li>
<li class="chapter" data-level="3.3.2" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#deriving-the-holiday-list"><i class="fa fa-check"></i><b>3.3.2</b> Deriving the Holiday List</a></li>
<li class="chapter" data-level="3.3.3" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#hurricane-effect-window"><i class="fa fa-check"></i><b>3.3.3</b> Hurricane Effect Window</a></li>
<li class="chapter" data-level="3.3.4" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#penultimate-model"><i class="fa fa-check"></i><b>3.3.4</b> Penultimate Model</a></li>
<li class="chapter" data-level="3.3.5" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#serial-autocorrelation-of-errors"><i class="fa fa-check"></i><b>3.3.5</b> Serial Autocorrelation of Errors</a></li>
<li class="chapter" data-level="3.3.6" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#heteroskedasticity"><i class="fa fa-check"></i><b>3.3.6</b> Heteroskedasticity</a></li>
<li class="chapter" data-level="3.3.7" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#final-model"><i class="fa fa-check"></i><b>3.3.7</b> Final Model</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="hurricane-impact-valuation.html"><a href="hurricane-impact-valuation.html#using-the-model"><i class="fa fa-check"></i><b>3.4</b> Using the Model</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html"><i class="fa fa-check"></i><b>4</b> Valuation of Care Interventions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#data-3"><i class="fa fa-check"></i><b>4.2</b> Data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#processed-dataset"><i class="fa fa-check"></i><b>4.2.1</b> Processed Dataset</a></li>
<li class="chapter" data-level="4.2.2" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#exposure"><i class="fa fa-check"></i><b>4.2.2</b> Exposure</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#model-fitting-4"><i class="fa fa-check"></i><b>4.3</b> Model Fitting</a></li>
<li class="chapter" data-level="4.4" data-path="valuation-of-care-interventions.html"><a href="valuation-of-care-interventions.html#using-the-model-1"><i class="fa fa-check"></i><b>4.4</b> Using the Model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Generalized Additive Models for Actuaries</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="valuation-of-care-interventions" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Valuation of Care Interventions<a href="valuation-of-care-interventions.html#valuation-of-care-interventions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-3" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Introduction<a href="valuation-of-care-interventions.html#introduction-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="data-3" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Data<a href="valuation-of-care-interventions.html#data-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="processed-dataset" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Processed Dataset<a href="valuation-of-care-interventions.html#processed-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Data preparation is an even more important step than usual in workflows like this.
Unfortunately, it involves a lot of protected health information, so we have to start with the processed, anonymized dataset.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="valuation-of-care-interventions.html#cb80-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="at">file =</span> <span class="fu">file.path</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;intv_data.csv&#39;</span>))</span>
<span id="cb80-2"><a href="valuation-of-care-interventions.html#cb80-2" aria-hidden="true" tabindex="-1"></a>fctrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;gdr&#39;</span>, <span class="st">&#39;prdct&#39;</span>, <span class="st">&#39;cdhp&#39;</span>, <span class="st">&#39;funding&#39;</span>, <span class="st">&#39;state&#39;</span>, <span class="st">&#39;covid&#39;</span>,</span>
<span id="cb80-3"><a href="valuation-of-care-interventions.html#cb80-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;intv&#39;</span>)</span>
<span id="cb80-4"><a href="valuation-of-care-interventions.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(fctr <span class="cf">in</span> fctrs) dat[, (fctr) <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(<span class="fu">get</span>(fctr))]</span>
<span id="cb80-5"><a href="valuation-of-care-interventions.html#cb80-5" aria-hidden="true" tabindex="-1"></a>dat[]</span></code></pre></div>
<pre><code>##          yr mth scrpts gdr prdct cdhp funding state covid     rs  intv dur
##     1: 2020   9      1   1     1    1       1     2 FALSE 6.9058 FALSE -17
##     2: 2020  10      1   1     1    1       1     2 FALSE 6.9058 FALSE -16
##     3: 2020  11      0   1     1    1       1     2 FALSE 6.9058 FALSE -15
##     4: 2020  12      0   1     1    1       1     2 FALSE 6.9058 FALSE -14
##     5: 2021   1      0   1     1    1       1     2 FALSE 6.9058 FALSE -13
##    ---                                                                    
## 45488: 2022   3     12   2     1    1       1     2 FALSE 2.6091 FALSE   0
## 45489: 2021  12      3   1     1    2       1     2 FALSE 5.0894 FALSE  -2
## 45490: 2022   1      3   1     1    2       1     2 FALSE 5.0894 FALSE  -1
## 45491: 2022   2      5   1     1    2       1     2 FALSE 5.0894 FALSE   0
## 45492: 2022   3      2   1     1    2       1     2 FALSE 5.0894  TRUE   1</code></pre>
<p>This dataset is a combination of items from many sources, representing a significant analytic challenge.
Here is a data dictionary summarizing the elements of this final table, along with some info about how it was processed into this final state.</p>
<ul>
<li><code>yr</code> - Year<br />
</li>
<li><code>mth</code> - Month<br />
</li>
<li><code>scrpts</code> - Number of scripts filled by the member that month. Taken from claims data.<br />
</li>
<li><code>gdr</code> - Member’s gender code. Taken from membership data.<br />
</li>
<li><code>prdct</code> - Product code, like PPO, HMO, etc. Taken from membership data.<br />
</li>
<li><code>cdhp</code> - Indicator for whether or not the product is a high-deductible health plan. Taken from membership data.<br />
</li>
<li><code>funding</code> - Funding type for the product, fully-insured or advisory services only. Taken from membership data.<br />
</li>
<li><code>state</code> - Indicator for the state the member resides in. Taken from membership data.<br />
</li>
<li><code>covid</code> - Indicator for whether or not the current month is 202003. Remember, the main COVID impact to the Rx line of business is a spike in utilization at the beginning of the pandemic as companies allowed members to stockpile medications.<br />
</li>
<li><code>rs</code> - Risk score for the individual. These are the output of a proprietary Optum model meant to track the costliness of a member. Note that these are only calculated quarterly, so the last known value is carried forward.<br />
</li>
<li><code>intv</code> - Indicator for whether or not the intervention has taken place. Calculated by joining data from operations tracking files to claims and membership data.<br />
</li>
<li><code>dur</code> - The number of months since the intervention has occurred.</li>
</ul>
<p>To summarize, then, we have four data sources that needed to be processed.</p>
<ol style="list-style-type: decimal">
<li>Claims - As a mature insurer, UHC has a strictly-structured claims database that serves as the source of truth for all clinical and financial operations around the company. Individuals are assigned a unique ID to facilitate joins.<br />
</li>
<li>Membership - The same goes for membership and eligibility data at UHC.<br />
</li>
<li>Risk Scores - These are maintained separately from claims and membership under the Symmetry product organization.
Unfortunately, this data source uses a different unique ID than the claims and membership data source.<br />
</li>
<li>Operations tracking files - a series of Excel workbooks maintained by the team actually administering the care intervention.
These files are, of course, ignorant of the claims, membership, and risk score unique IDs, and are instead organized by member name.</li>
</ol>
<p>The bulk of the initial work, therefore, was mapping member names to data source unique IDs.</p>
</div>
<div id="exposure" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Exposure<a href="valuation-of-care-interventions.html#exposure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s take a look at what the time series of scripts looks like.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="valuation-of-care-interventions.html#cb82-1" aria-hidden="true" tabindex="-1"></a>pdat <span class="ot">&lt;-</span> dat[</span>
<span id="cb82-2"><a href="valuation-of-care-interventions.html#cb82-2" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb82-3"><a href="valuation-of-care-interventions.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">scrpts =</span> <span class="fu">sum</span>(scrpts)),</span>
<span id="cb82-4"><a href="valuation-of-care-interventions.html#cb82-4" aria-hidden="true" tabindex="-1"></a>  keyby <span class="ot">=</span> .(<span class="at">yrmo =</span> <span class="fu">paste0</span>(yr, <span class="fu">ifelse</span>(mth <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="dv">0</span>, <span class="st">&#39;&#39;</span>), mth))</span>
<span id="cb82-5"><a href="valuation-of-care-interventions.html#cb82-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb82-6"><a href="valuation-of-care-interventions.html#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pdat) <span class="sc">+</span></span>
<span id="cb82-7"><a href="valuation-of-care-interventions.html#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="fu">factor</span>(yrmo), scrpts, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb82-8"><a href="valuation-of-care-interventions.html#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb82-9"><a href="valuation-of-care-interventions.html#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>(), <span class="at">y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb82-10"><a href="valuation-of-care-interventions.html#cb82-10" aria-hidden="true" tabindex="-1"></a>  mytheme <span class="sc">+</span></span>
<span id="cb82-11"><a href="valuation-of-care-interventions.html#cb82-11" aria-hidden="true" tabindex="-1"></a>  theme_rotx</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="valuation-of-care-interventions.html#cb83-1" aria-hidden="true" tabindex="-1"></a>exposure <span class="ot">&lt;-</span> dat[</span>
<span id="cb83-2"><a href="valuation-of-care-interventions.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb83-3"><a href="valuation-of-care-interventions.html#cb83-3" aria-hidden="true" tabindex="-1"></a>  .N,</span>
<span id="cb83-4"><a href="valuation-of-care-interventions.html#cb83-4" aria-hidden="true" tabindex="-1"></a>  keyby <span class="ot">=</span> .(dur)</span>
<span id="cb83-5"><a href="valuation-of-care-interventions.html#cb83-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb83-6"><a href="valuation-of-care-interventions.html#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="valuation-of-care-interventions.html#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(exposure) <span class="sc">+</span></span>
<span id="cb83-8"><a href="valuation-of-care-interventions.html#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(dur, N)) <span class="sc">+</span></span>
<span id="cb83-9"><a href="valuation-of-care-interventions.html#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb83-10"><a href="valuation-of-care-interventions.html#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Observations&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Months Since Intervention&#39;</span>) <span class="sc">+</span></span>
<span id="cb83-11"><a href="valuation-of-care-interventions.html#cb83-11" aria-hidden="true" tabindex="-1"></a>  mytheme</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
</div>
</div>
<div id="model-fitting-4" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Model Fitting<a href="valuation-of-care-interventions.html#model-fitting-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For this model, I made use of the random effects spline basis.
If you scroll almost all the way down to the bottom of the output of <code>?smooth.terms</code>, you will find out that there is a way of constructing a smooth term that yields the equivalent of a random effects term from mixed models.
A random effects model treats the estimated coefficients as realizations of a random variable.
This is preferable in many circumstances, one of which being those we have here, where we have a small sample of a much larger population.
It’s not just unlikely that the mean pharmacy quantity consumed by this population is anything like the true mean of the entire UHC book of business, much less the US as a whole: we know this beforehand because we are taking a sample of some of the most expensive members that UHC covers.
Being able to use a model form that takes into account the bias in our sample will improve the ability of the model to generate useful, generalizable insights.</p>
<p>The code to fit it is found in the following chunk.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="valuation-of-care-interventions.html#cb84-1" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makePSOCKcluster</span>(<span class="fu">detectCores</span>())</span>
<span id="cb84-2"><a href="valuation-of-care-interventions.html#cb84-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">bam</span>(</span>
<span id="cb84-3"><a href="valuation-of-care-interventions.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  scrpts <span class="sc">~</span> <span class="fu">s</span>(yr, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb84-4"><a href="valuation-of-care-interventions.html#cb84-4" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">s</span>(mth, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb84-5"><a href="valuation-of-care-interventions.html#cb84-5" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> covid</span>
<span id="cb84-6"><a href="valuation-of-care-interventions.html#cb84-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">s</span>(rs, <span class="at">bs =</span> <span class="st">&#39;cs&#39;</span>)</span>
<span id="cb84-7"><a href="valuation-of-care-interventions.html#cb84-7" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">s</span>(gdr, <span class="at">bs =</span> <span class="st">&#39;re&#39;</span>)</span>
<span id="cb84-8"><a href="valuation-of-care-interventions.html#cb84-8" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">s</span>(prdct, <span class="at">bs =</span> <span class="st">&#39;re&#39;</span>)</span>
<span id="cb84-9"><a href="valuation-of-care-interventions.html#cb84-9" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">s</span>(state, <span class="at">bs =</span> <span class="st">&#39;re&#39;</span>)</span>
<span id="cb84-10"><a href="valuation-of-care-interventions.html#cb84-10" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">s</span>(cdhp, <span class="at">bs =</span> <span class="st">&#39;re&#39;</span>)</span>
<span id="cb84-11"><a href="valuation-of-care-interventions.html#cb84-11" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">s</span>(funding, <span class="at">bs =</span> <span class="st">&#39;re&#39;</span>)</span>
<span id="cb84-12"><a href="valuation-of-care-interventions.html#cb84-12" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> intv,</span>
<span id="cb84-13"><a href="valuation-of-care-interventions.html#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">nb</span>(),</span>
<span id="cb84-14"><a href="valuation-of-care-interventions.html#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat[</span>
<span id="cb84-15"><a href="valuation-of-care-interventions.html#cb84-15" aria-hidden="true" tabindex="-1"></a>    exposure[N <span class="sc">&gt;</span> <span class="dv">99</span>, ],</span>
<span id="cb84-16"><a href="valuation-of-care-interventions.html#cb84-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">on =</span> <span class="st">&#39;dur&#39;</span></span>
<span id="cb84-17"><a href="valuation-of-care-interventions.html#cb84-17" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb84-18"><a href="valuation-of-care-interventions.html#cb84-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> cl</span>
<span id="cb84-19"><a href="valuation-of-care-interventions.html#cb84-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-20"><a href="valuation-of-care-interventions.html#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb84-21"><a href="valuation-of-care-interventions.html#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(m, <span class="at">file =</span> <span class="fu">file.path</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;m_intv.RDS&#39;</span>))</span></code></pre></div>
<p>Again, I have cached the fitted model in our Github repo for ease of use.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="valuation-of-care-interventions.html#cb85-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="fu">file.path</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;m_intv.RDS&#39;</span>))</span>
<span id="cb85-2"><a href="valuation-of-care-interventions.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<pre><code>## 
## Family: Negative Binomial(1.928) 
## Link function: log 
## 
## Formula:
## scrpts ~ s(yr, k = 3) + s(mth, k = 4) + covid + s(rs, bs = &quot;cs&quot;) + 
##     s(gdr, bs = &quot;re&quot;) + s(prdct, bs = &quot;re&quot;) + s(state, bs = &quot;re&quot;) + 
##     s(cdhp, bs = &quot;re&quot;) + s(funding, bs = &quot;re&quot;) + intv
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.84074    0.10203   8.240  &lt; 2e-16 ***
## covidTRUE    0.16487    0.02937   5.614 1.99e-08 ***
## intvTRUE    -0.05447    0.01383  -3.937 8.25e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##               edf Ref.df       F  p-value    
## s(yr)      1.6936  1.905  122.93  &lt; 2e-16 ***
## s(mth)     2.6623  2.913   33.30  &lt; 2e-16 ***
## s(rs)      8.7355  9.000 1860.94  &lt; 2e-16 ***
## s(gdr)     0.9861  1.000   99.85  &lt; 2e-16 ***
## s(prdct)   2.8744  3.000  364.05  &lt; 2e-16 ***
## s(state)   2.9337  3.000  308.15  &lt; 2e-16 ***
## s(cdhp)    0.9933  1.000  948.65  &lt; 2e-16 ***
## s(funding) 0.9476  1.000  454.82 1.25e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.203   Deviance explained = 20.5%
## fREML =  64839  Scale est. = 1         n = 45236</code></pre>
<p>An <span class="math inline">\(R^2\)</span> of ~20% is actually quite good for monthly, individual-level claims data.
Like I said earlier, healthcare claims are just one of those subject areas that exhibit very high variance.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="valuation-of-care-interventions.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m, <span class="at">select =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="valuation-of-care-interventions.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m, <span class="at">select =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="valuation-of-care-interventions.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m, <span class="at">select =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="gams-for-actuaries_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="using-the-model-1" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Using the Model<a href="valuation-of-care-interventions.html#using-the-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hurricane-impact-valuation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
